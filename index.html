<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ECOSTACK AI - CEO Cloud Panel</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getDatabase, ref, push, onValue, update } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

        const firebaseConfig = {
            apiKey: "AIzaSyD4QK67Y22aYtzUgMNESQfXVax51Tk2zy0",
            authDomain: "autostack-ai.firebaseapp.com",
            projectId: "autostack-ai",
            storageBucket: "autostack-ai.firebasestorage.app",
            messagingSenderId: "35493907558",
            appId: "1:35493907558:web:34c1c21e5a85bcae2131a7",
            measurementId: "G-P1VJ0FTMX9"
        };

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);

        window.checkAdminAuth = function() {
            const input = document.getElementById('adminKey').value;
            if(input === "rubinaramjan@14") {
                document.getElementById('adminQueueSection').classList.remove('hidden');
                syncRequests();
            }
        };

        window.sendRequest = function() {
            const amt = document.getElementById('share').innerText;
            if(amt === "â‚¹0.00") return alert("Pehle code audit karein!");
            const reqID = "REQ-" + Math.floor(1000 + Math.random() * 9000);
            push(ref(db, 'live_requests'), { id: reqID, amount: amt, status: 'PENDING' });
            alert("Request Sent! ID: " + reqID);
            window.open(`https://wa.me/9096530829?text=CEO%20Approve%20ID:%20${reqID}`);
        };

        function syncRequests() {
            onValue(ref(db, 'live_requests'), (snap) => {
                const container = document.getElementById('queue');
                container.innerHTML = "";
                const data = snap.val();
                if(data) Object.keys(data).reverse().forEach(key => {
                    const r = data[key];
                    container.innerHTML += `<div class="p-3 border border-slate-700 mb-2 flex justify-between bg-slate-800 rounded-lg">
                        <span class="text-xs font-bold text-blue-300">${r.id}<br><span class="text-green-400">${r.amount}</span></span>
                        ${r.status==='PENDING' ? `<button onclick="approve('${key}')" class="bg-green-600 px-4 rounded text-[10px] font-bold">APPROVE</button>` : `<span class="text-[10px] text-slate-500 font-bold uppercase">${r.status}</span>`}
                    </div>`;
                });
            });
        }

        window.approve = function(key) {
            update(ref(db, `live_requests/${key}`), { status: 'APPROVED' });
            document.getElementById('lock').style.display = 'none';
        };

        document.getElementById('userInput').addEventListener('input', (e) => {
            const len = e.target.value.length;
            const waste = (len * 0.45).toFixed(2);
            const share = (waste * 0.35).toFixed(2);
            document.getElementById('bill').innerText = "â‚¹" + waste;
            document.getElementById('share').innerText = "â‚¹" + share;
        });
    </script>
</head>
<body class="bg-slate-950 text-slate-200 p-4 font-sans">
    <div class="max-w-md mx-auto space-y-4 text-center">
        <h1 class="text-xl font-black text-blue-500 italic">ECOSTACK AI</h1>
        <input type="password" id="adminKey" oninput="checkAdminAuth()" placeholder="Enter CEO Access Code" class="bg-slate-900 border border-blue-900/30 p-3 rounded-xl text-xs w-full text-center outline-none focus:border-blue-500">
        
        <div id="adminQueueSection" class="hidden bg-slate-900 p-4 rounded-2xl border border-blue-600 text-left shadow-2xl">
            <p class="text-[10px] font-black text-blue-400 mb-3 tracking-widest uppercase">Live Approval Queue</p>
            <div id="queue"></div>
        </div>

        <div class="bg-slate-900 p-5 rounded-2xl border border-slate-800">
            <p class="text-[10px] text-red-500 font-black mb-2 uppercase text-left">Code Audit Input</p>
            <textarea id="userInput" class="w-full h-32 bg-black/50 p-3 text-xs font-mono rounded-xl border border-slate-800 outline-none focus:border-red-500" placeholder="Paste code here..."></textarea>
            <div class="flex justify-between mt-4 bg-black/30 p-3 rounded-lg border border-slate-800">
                <div class="text-left"><p class="text-[8px] text-slate-500 uppercase">Waste Found</p><p id="bill" class="font-bold">â‚¹0.00</p></div>
                <div class="text-right"><p class="text-[8px] text-green-500 uppercase">CEO Share</p><p id="share" class="font-bold text-green-400">â‚¹0.00</p></div>
            </div>
        </div>

        <div class="bg-slate-900 p-5 rounded-2xl border border-slate-800 relative overflow-hidden">
            <div id="lock" class="absolute inset-0 bg-slate-950/95 flex flex-col items-center justify-center z-20">
                <span class="text-2xl mb-2">ðŸ”’</span>
                <p class="text-[10px] font-black tracking-tighter text-slate-400">WAITING FOR CEO APPROVAL</p>
            </div>
            <p class="text-[10px] text-green-400 font-black mb-2 uppercase text-left">AI Cleaned Output</p>
            <div class="h-24 text-[10px] font-mono text-slate-500 italic p-2 bg-black/30 rounded-lg text-left">Optimized code will appear here after approval...</div>
        </div>

        <button onclick="sendRequest()" class="w-full bg-blue-600 hover:bg-blue-700 py-4 rounded-2xl font-black text-xs shadow-lg transition-all active:scale-95">SEND REQUEST TO CEO</button>
        <p class="text-[9px] text-slate-600 uppercase font-bold">Powered by Autostack AI Cloud</p>
    </div>
</body>
</html>
