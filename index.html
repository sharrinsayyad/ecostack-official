<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ECOSTACK AI - CEO Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { background-color: #0f172a; color: #f8fafc; font-family: sans-serif; }
        .box-style { background: #1e293b; border: 1px solid #334155; border-radius: 12px; padding: 20px; }
        .accent-green { color: #22c55e; }
        .loading-spinner { border: 4px solid rgba(255,255,255,0.1); border-top: 4px solid #22c55e; border-radius: 50%; width: 40px; height: 40px; animation: spin 1s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .hidden-panel { display: none; }
    </style>
</head>
<body class="p-6">

    <header class="text-center mb-8">
        <h1 class="text-3xl font-black accent-green tracking-tight">ECOSTACK AI</h1>
        <p class="text-slate-400 text-[10px] uppercase tracking-[0.3em]">Global Code Audit Engine</p>
    </header>

    <div class="max-w-7xl mx-auto space-y-6">
        
        <div class="grid md:grid-cols-2 gap-6">
            <div class="box-style">
                <h2 class="font-bold mb-2 text-red-400 text-sm">AUDIT CODE (INPUT)</h2>
                <textarea id="userInput" class="w-full h-64 bg-slate-900 p-4 font-mono text-xs border border-slate-700 rounded focus:outline-none" placeholder="Paste messy code here..."></textarea>
            </div>
            <div class="box-style relative">
                <div id="lockOverlay" class="absolute inset-0 bg-slate-950/95 flex flex-col items-center justify-center rounded-xl z-10 text-center">
                    <div id="lockIcon" class="text-3xl mb-2">üîí</div>
                    <div id="loader" class="hidden loading-spinner mb-4"></div>
                    <p id="lockStatus" class="font-bold text-xs">Waiting for CEO Approval</p>
                    <p class="text-[10px] text-slate-500 mt-2">ID: <span id="displayReqCode" class="text-blue-400"></span></p>
                </div>
                <h2 class="font-bold mb-2 text-green-400 text-sm">OPTIMIZED OUTPUT</h2>
                <div id="optimizedCode" class="w-full h-64 bg-slate-900 p-4 font-mono text-xs overflow-auto text-slate-600 italic">
                    // Encrypted...
                </div>
            </div>
        </div>

        <div class="grid grid-cols-2 md:grid-cols-4 gap-4 text-center">
            <div class="box-style border-b-2 border-red-500 py-4">
                <p class="text-[9px] text-slate-500 uppercase">Worst Bill</p>
                <p id="bill" class="text-lg font-bold">‚Çπ0.00</p>
            </div>
            <div class="box-style border-b-2 border-blue-500 py-4">
                <p class="text-[9px] text-slate-500 uppercase">Savings</p>
                <p id="savings" class="text-lg font-bold">‚Çπ0.00</p>
            </div>
            <div class="box-style border-b-2 border-green-500 py-4 bg-green-900/5">
                <p class="text-[9px] text-green-500 uppercase">35% Share</p>
                <p id="share" class="text-lg font-bold text-green-400">‚Çπ0.00</p>
            </div>
            <div class="box-style border-b-2 border-yellow-500 py-4">
                <p class="text-[9px] text-slate-500 uppercase">Power</p>
                <p id="power" class="text-lg font-bold">-- kWh</p>
            </div>
        </div>

        <div class="grid md:grid-cols-2 gap-6">
            <div class="box-style text-center">
                <h3 class="font-bold mb-4 text-xs">PAYMENT & REQUEST</h3>
                <div id="qrBox" class="bg-white p-2 inline-block rounded mb-4 shadow-lg"></div>
                <button onclick="sendWhatsApp()" class="w-full bg-blue-600 py-3 rounded-xl font-bold text-xs uppercase">I've Paid - Request Approval</button>
            </div>

            <div class="box-style">
                <h3 class="font-bold mb-4 text-xs text-yellow-500 text-center uppercase">CEO Login</h3>
                <input type="password" id="adminKey" oninput="checkKey()" class="w-full bg-slate-900 border border-slate-700 p-3 rounded-xl text-center text-sm font-mono" placeholder="Enter Admin Code">
                
                <div id="adminControls" class="hidden-panel mt-6 pt-6 border-t border-slate-700">
                    <div class="flex gap-4 mb-4">
                        <button onclick="handleRequest('APPROVE')" class="w-1/2 bg-green-600 text-white font-bold py-3 rounded-xl text-xs uppercase">Approve ‚úÖ</button>
                        <button onclick="handleRequest('REJECT')" class="w-1/2 bg-red-600 text-white font-bold py-3 rounded-xl text-xs uppercase">Reject ‚ùå</button>
                    </div>
                    <button id="dlBtn" onclick="downloadReport()" class="hidden w-full bg-white text-black py-2 rounded-xl text-xs font-bold mb-4">Download PDF Report</button>
                    
                    <div id="historyPanel" class="mt-4 bg-black/30 p-2 rounded-lg max-h-32 overflow-auto">
                        <p class="text-[10px] text-slate-500 mb-2 uppercase font-bold">Audit Logs</p>
                        <table class="w-full text-left text-[9px] font-mono">
                            <tbody id="historyData"></tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const THE_KEY = "rubinaramjan@14";
        let reqID = "REQ-" + Math.floor(1000 + Math.random() * 9000);
        document.getElementById('displayReqCode').innerText = reqID;

        // Unlock Admin Panel as you type
        function checkKey() {
            const val = document.getElementById('adminKey').value;
            if(val === THE_KEY) {
                document.getElementById('adminControls').style.display = 'block';
            } else {
                document.getElementById('adminControls').style.display = 'none';
            }
        }

        document.getElementById('userInput').addEventListener('input', function(e) {
            const val = e.target.value;
            if(val.length > 5) {
                const waste = (val.length * 0.5).toFixed(2);
                const save = (waste * 0.7).toFixed(2);
                const comm = (save * 0.35).toFixed(2);
                const kwh = (val.length * 0.01).toFixed(3);
                document.getElementById('bill').innerText = '‚Çπ' + waste;
                document.getElementById('savings').innerText = '‚Çπ' + save;
                document.getElementById('share').innerText = '‚Çπ' + comm;
                document.getElementById('power').innerText = kwh + ' kWh';
                const upi = `upi://pay?pa=sayyadsharrin0@okaxis&pn=Sharrin%20Sayyad&am=${comm}&cu=INR`;
                document.getElementById('qrBox').innerHTML = `<img src="https://api.qrserver.com/v1/create-qr-code/?size=130x130&data=${encodeURIComponent(upi)}" alt="QR">`;
            }
        });

        function sendWhatsApp() {
            const amt = document.getElementById('share').innerText;
            const msg = `ECOSTACK AI ALERT:\nID: ${reqID}\nPaid: ${amt}\n\nCEO Ma'am, please approve!`;
            window.open(`https://wa.me/9096530829?text=${encodeURIComponent(msg)}`);
        }

        function handleRequest(action) {
            if(action === 'APPROVE') {
                document.getElementById('lockIcon').classList.add('hidden');
                document.getElementById('loader').classList.remove('hidden');
                document.getElementById('lockStatus').innerText = "AI OPTIMIZING...";
                setTimeout(() => {
                    document.getElementById('lockOverlay').style.display = 'none';
                    document.getElementById('optimizedCode').innerText = "// SUCCESS: OPTIMIZED\n// ID: " + reqID + "\n\nfunction efficiency() { return true; }";
                    document.getElementById('optimizedCode').classList.add('text-green-400');
                    document.getElementById('dlBtn').classList.remove('hidden');
                    addLog('APPROVED');
                }, 3000);
            } else {
                alert("Request Rejected.");
                addLog('REJECTED');
            }
        }

        function addLog(status) {
            const now = new Date();
            const color = status === 'APPROVED' ? 'text-green-400' : 'text-red-400';
            const row = `<tr class="border-b border-slate-800"><td class="py-1">${reqID}</td><td class="py-1 ${color}">${status}</td></tr>`;
            document.getElementById('historyData').innerHTML += row;
        }

        function downloadReport() {
            const content = `ECOSTACK AI REPORT\nID: ${reqID}\nStatus: APPROVED\nAmt: ${document.getElementById('share').innerText}`;
            const blob = new Blob([content], { type: 'text/plain' });
            const link = document.createElement('a');
            link.href = window.URL.createObjectURL(blob);
            link.download = `Report_${reqID}.txt`;
            link.click();
        }
    </script>
</body>
</html>
